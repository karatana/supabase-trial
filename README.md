# Various Auth Trial

- supabase を使った電話番号ログインと変更

## 環境設定

- https://supabase.com/docs/guides/auth の `Phone Auth` セクションを見ながら設定
  - Vercel 環境では Twilio を利用中
- GitHub のコードスペースを利用する場合、 `Authentication > URL Configuration > Site URL` にて取得したドメインを設定
- `logged_in_counts` テーブルを作成

  ```sql
  create table logged_in_counts (
    id bigint generated by default as identity not null,
    inserted_at timestamp with time zone not null default timezone ('utc'::text, now()),
    updated_at timestamp with time zone not null default timezone ('utc'::text, now()),
    counts integer null,
    user_id uuid null,
    constraint logged_in_counts_pkey primary key (id),
    constraint logged_in_counts_user_id_key unique (user_id),
    constraint logged_in_counts_user_id_fkey foreign key (user_id) references auth.users (id)
  );
  ```

- Vercel を利用する場合、 supabase と production, preview にて接続する

## Clone and run locally

- GitHub のコードスペースで立ち上げて、ポートを 3000 で動かす前提で `next.config.js` を実装している
- `.env.local` の設定を更新
- あとは https://supabase.com/docs/guides/auth/quickstarts/nextjs のとおり

  ```bash
  npm run dev
  ```

## 参考

- https://supabase.com/docs/guides/auth/quickstarts/nextjs
- https://supabase.com/docs/guides/auth/phone-login
- https://nextjs.org/docs/pages/building-your-application/configuring/environment-variables
